<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Example</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>

<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="site_libs/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.9em;
  padding-left: 5px;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <!-- NOTE: add "navbar-inverse" class for an alternate navbar background -->
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">airGR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li><a href="index.html">Home</a></li>
        <li><a href="tutorial_1_example_simple.html">Example</a></li>
		<li><a href="tutorial_2_customization.html">Customization</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
		<li><a href="http://webgr.irstea.fr/?lang=en">Catchment Hydrology Team (Antony - France)</a></li>
        <a href='http://www.irstea.fr/en/', title="irstea.fr"><img src='logo/logo_irstea.svg' style='width:45px;height:45px;'></a>
		<a href='http://webgr.irstea.fr/?lang=en', title="webgr.irstea.fr"><img src='logo/logo_irstea_hydro_COUL_smooth.svg' style='width:45px;height:45px;'></a>
		<a href='http://webgr.irstea.fr/activites/airgr/?lang=en', title="aiGR"><img src='logo/logo_airGR.svg' style='width:45px;height:45px;'></a>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Example</h1>

</div>


<div id="loading-data" class="section level1">
<h1><span class="header-section-number">1</span> Loading data</h1>
<p>In the following example, we use a data sample contained in the package, but the user have to import himself his data into <strong>R</strong>.</p>
<p>Loading package</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(airGR)</code></pre></div>
<p>This is an example of a <code>data.frame</code> of time series of observations of a fictional catchment which contains:</p>
<ul>
<li><em>DatesR</em>: time series dates in the POSIXt format</li>
<li><em>P</em>: average precipitation [mm/day]</li>
<li><em>T</em>: catchment average air temperature [℃]</li>
<li><em>E</em>: catchment average potential evapotranspiration [mm/day]</li>
<li><em>Qls</em>: outlet discharge [l/s]</li>
<li><em>Qmm</em>: outlet discharge [mm/day]</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(L0123001)
<span class="kw">summary</span>(BasinObs)</code></pre></div>
<pre><code>##      DatesR                 P                T                 E        
##  Min.   :1984-01-01   Min.   : 0.000   Min.   :-18.700   Min.   :0.000  
##  1st Qu.:1991-04-02   1st Qu.: 0.000   1st Qu.:  4.100   1st Qu.:0.600  
##  Median :1998-07-02   Median : 0.300   Median :  9.100   Median :1.400  
##  Mean   :1998-07-02   Mean   : 2.915   Mean   :  9.147   Mean   :1.764  
##  3rd Qu.:2005-10-01   3rd Qu.: 3.600   3rd Qu.: 14.500   3rd Qu.:2.900  
##  Max.   :2012-12-31   Max.   :66.800   Max.   : 28.400   Max.   :5.500  
##                                                                         
##       Qls             Qmm         
##  Min.   :   70   Min.   : 0.0168  
##  1st Qu.: 1643   1st Qu.: 0.3943  
##  Median : 4070   Median : 0.9768  
##  Mean   : 6134   Mean   : 1.4720  
##  3rd Qu.: 7889   3rd Qu.: 1.8933  
##  Max.   :99500   Max.   :23.8800  
##  NA&#39;s   :755     NA&#39;s   :755</code></pre>
<p>Of course you can load your own data with the usual functions (e.g. <code>read.table()</code>).</p>
</div>
<div id="preparation-of-inputs" class="section level1">
<h1><span class="header-section-number">2</span> Preparation of inputs</h1>
<p>To run a model, the package requires data and options with specific formats.</p>
<p>To facilitate the use of the package, there are several functions which allow to create these objects from simple data:</p>
<ul>
<li><code>CreateInputsModel()</code>: to prepare the inputs for the different hydrological models (times series of dates, rainfall, flow, etc.)</li>
<li><code>CreateCalibOptions()</code>: to prepare the options for the hydrological model calibration (choice of parameters to optimize, values of the fixed parameters, etc.)</li>
<li><code>CreateRunOptions()</code>: to prepare the options for the hydrological model run (warm-up period, calibration period, etc.)</li>
<li><code>CreateInputsCrit()</code>: to prepare the options in order to compute efficiency criterions (to choose the criterion, to choose the transformation on flows: “log”, “root”, etc.)</li>
</ul>
<div id="inputsmodel-object" class="section level2">
<h2><span class="header-section-number">2.1</span> InputsModel object</h2>
<p>To run a GR hydrologic model, the user have to prepare the input data with the <code>CeateInputsModel()</code> function. This function needs the name function relative to the model the user want to run, a vector of dates and a of precipitation.</p>
<p>In the example we already have the potential evapotranspiration. If the user don’t have it, it is possible to compute the potential evapotranspiration with Oudin’s formaul with the <code>PEdaily_Oudin()</code> function (needs julian days, daily mean air temperature and latitude).</p>
<p>Missing values (<code>NA</code>) of precipiation (or potential evapotranspiration) are <strong>not allowed</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">InputsModel &lt;-<span class="st"> </span><span class="kw">CreateInputsModel</span>(<span class="dt">FUN_MOD =</span> RunModel_GR4J, <span class="dt">DatesR =</span> BasinObs$DatesR,
                                 <span class="dt">Precip =</span> BasinObs$P, <span class="dt">PotEvap =</span> BasinObs$E)
<span class="kw">str</span>(InputsModel)</code></pre></div>
<pre><code>## List of 3
##  $ DatesR : POSIXlt[1:10593], format: &quot;1984-01-01&quot; &quot;1984-01-02&quot; ...
##  $ Precip : num [1:10593] 4.1 15.9 0.8 0 0 0 0 0 2.9 0 ...
##  $ PotEvap: num [1:10593] 0.2 0.2 0.3 0.3 0.1 0.3 0.4 0.4 0.5 0.5 ...
##  - attr(*, &quot;class&quot;)= chr [1:3] &quot;InputsModel&quot; &quot;daily&quot; &quot;GR&quot;</code></pre>
</div>
<div id="runoptions-object" class="section level2">
<h2><span class="header-section-number">2.2</span> RunOptions object</h2>
<p>The <code>CreateRunOptions()</code> function allows to prepare the options required to the <code>RunModel*()</code> functions.</p>
<p>The user must at least define:</p>
<ul>
<li><code>FUN_MOD</code>: the name of the model function to run</li>
<li><code>InputsModel</code>: the associated inputs data</li>
<li><code>IndPeriod_Run</code>: the run period of the model</li>
</ul>
<p>To select a period for which the user want to run the model, select the corresponding indices for different time period but not directly the POSIXt dates.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Ind_Run &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="kw">which</span>(<span class="kw">format</span>(BasinObs$DatesR, <span class="dt">format =</span> <span class="st">&quot;%d/%m/%Y %H:%M&quot;</span>)==<span class="st">&quot;01/01/1990 00:00&quot;</span>), 
               <span class="kw">which</span>(<span class="kw">format</span>(BasinObs$DatesR, <span class="dt">format =</span> <span class="st">&quot;%d/%m/%Y %H:%M&quot;</span>)==<span class="st">&quot;31/12/1999 00:00&quot;</span>))
<span class="kw">str</span>(Ind_Run)</code></pre></div>
<pre><code>##  int [1:3652] 2193 2194 2195 2196 2197 2198 2199 2200 2201 2202 ...</code></pre>
<p>The models simulate the calculated flow rates if the initial state is known at the beginning of the simulation period. Given the arbitrary nature of initialization, the first values of simulated discharges will not be reliable and should not be taken into account for the calculation of the criterion function. This period must be long enough (at least one year: winter + summer)</p>
<p>So, it is also possible to defin other arguments like:</p>
<ul>
<li><code>IniStates</code>: the states of the 2 unit hydrographs (20 + 40 = 60 units)</li>
<li><code>IniResLevels</code>: the levels of the production and routing stores</li>
<li><code>IndPeriod_WarmUp</code>: the warm-up period to adjust <code>IniStates</code> and <code>IniResLevels</code></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RunOptions &lt;-<span class="st"> </span><span class="kw">CreateRunOptions</span>(<span class="dt">FUN_MOD =</span> RunModel_GR4J,
                               <span class="dt">InputsModel =</span> InputsModel, <span class="dt">IndPeriod_Run =</span> Ind_Run,
                               <span class="dt">IniStates =</span> <span class="ot">NULL</span>, <span class="dt">IniResLevels =</span> <span class="ot">NULL</span>, <span class="dt">IndPeriod_WarmUp =</span> <span class="ot">NULL</span>)</code></pre></div>
<pre><code>## Warning in CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel, :     Model warm-up period not defined -&gt; default configuration used 
##      The year preceding the run period is used</code></pre>
<pre><code>## Warning in CreateRunOptions(FUN_MOD = RunModel_GR4J, InputsModel = InputsModel, :     Model states initialisation not defined -&gt; default configuration used</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(RunOptions)</code></pre></div>
<pre><code>## List of 6
##  $ IndPeriod_WarmUp: int [1:365] 1828 1829 1830 1831 1832 1833 1834 1835 1836 1837 ...
##  $ IndPeriod_Run   : int [1:3652] 2193 2194 2195 2196 2197 2198 2199 2200 2201 2202 ...
##  $ IniStates       : num [1:67] 0 0 0 0 0 0 0 0 0 0 ...
##  $ IniResLevels    : num [1:2] 0.3 0.5
##  $ Outputs_Cal     : chr &quot;Qsim&quot;
##  $ Outputs_Sim     : chr [1:16] &quot;DatesR&quot; &quot;PotEvap&quot; &quot;Precip&quot; &quot;Prod&quot; ...
##  - attr(*, &quot;class&quot;)= chr [1:3] &quot;RunOptions&quot; &quot;GR&quot; &quot;daily&quot;</code></pre>
<p>The <code>CreateRunOptions()</code> function returns warnings if the default initialisation options are used:</p>
<ul>
<li><code>IniStates</code> and <code>IniResLevels</code> are automatically set to initialise all the model states at 0, except for the production and routing stores which are initialised at 50 % of their capacity</li>
<li><code>IndPeriod_WarmUp</code> default setting ensures a one-year warm-up using the time steps preceding the <code>IndPeriod_Run</code></li>
</ul>
</div>
</div>
<div id="criterions" class="section level1">
<h1><span class="header-section-number">3</span> Criterions</h1>
<p>The evaluation of the quality of a simulation criteria can be used both as objective function during the calibration of the model, or as a measure for evaluating its control performance.</p>
<p>The package offers the possibility to use different criterions:</p>
<ul>
<li><code>ErrorCrit_RMSE()</code>: Root-mean-square error (RMSE)</li>
<li><code>ErrorCrit_NSE()</code>: Nashâ€“Sutcliffe model efficiency coefficient (NSE)</li>
<li><code>ErrorCrit_KGE()</code>: Kling-Gupta efficiency criterion (KGE)</li>
<li><code>ErrorCrit_KGE2()</code>: Kling-Gupta efficiency criterion (KGE’)</li>
</ul>
<p>It is also possible to create your own criterion. For that, you just have to define your own function in <strong>R</strong>.</p>
</div>
<div id="calibration" class="section level1">
<h1><span class="header-section-number">4</span> Calibration</h1>
<p>The objective of the calibration step is learning model to identify and recognize the hydrology of the watershed: by comparing the model with input and output observed series, one can find the combination of parameters for representing the better behavior of the watershed.</p>
<div id="preparation-of-inputs-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Preparation of inputs</h2>
<div id="inputscrit-object" class="section level3">
<h3><span class="header-section-number">4.1.1</span> InputsCrit object</h3>
<p>The <code>CreateInputsCrit()</code> allows to prepare the input in order to calibrate the model. The user have to define at least:</p>
<ul>
<li><code>FUN_CRIT</code>: the error criterion function</li>
<li><code>InputsModel</code>: the inputs of hydrological model previously prepare by the <code>CeateInputsModel()</code> function</li>
<li><code>RunOptions</code>: the options for the hydrological model previously prepare by the <code>CreateRunOptions()</code> function</li>
<li><code>Qobs</code>: the observed discharges serie expressed in <em>mm/time step</em></li>
</ul>
<p>Missing values (<code>NA</code>) of observed discharges are <strong>allowed</strong>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">InputsCrit &lt;-<span class="st"> </span><span class="kw">CreateInputsCrit</span>(<span class="dt">FUN_CRIT =</span> ErrorCrit_NSE, <span class="dt">InputsModel =</span> InputsModel, 
                               <span class="dt">RunOptions =</span> RunOptions, <span class="dt">Qobs =</span> BasinObs$Qmm[Ind_Run])
<span class="kw">str</span>(InputsCrit)</code></pre></div>
<pre><code>## List of 5
##  $ BoolCrit  : logi [1:3652] TRUE TRUE TRUE TRUE TRUE TRUE ...
##  $ Qobs      : num [1:3652] 1.99 1.8 2.86 2.4 3.31 ...
##  $ transfo   : chr &quot;&quot;
##  $ Ind_zeroes: NULL
##  $ epsilon   : NULL
##  - attr(*, &quot;class&quot;)= chr &quot;InputsCrit&quot;</code></pre>
</div>
<div id="caliboptions-object" class="section level3">
<h3><span class="header-section-number">4.1.2</span> CalibOptions object</h3>
<p>The user also need to prepar the calibration option with the <code>CreateCalibOptions()</code>function. For that he had to define:</p>
<ul>
<li><code>FUN_MOD</code>: the name of the model function to run</li>
<li><code>FUN_CALIB</code>: the name of the calibration algorithm</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CalibOptions &lt;-<span class="st"> </span><span class="kw">CreateCalibOptions</span>(<span class="dt">FUN_MOD =</span> RunModel_GR4J, <span class="dt">FUN_CALIB =</span> Calibration_Michel)
<span class="kw">str</span>(CalibOptions)</code></pre></div>
<pre><code>## List of 5
##  $ OptimParam       : logi [1:4] TRUE TRUE TRUE TRUE
##  $ FixedParam       : logi [1:4] NA NA NA NA
##  $ SearchRanges     : num [1:2, 1:4] 4.59e-05 2.18e+04 -1.09e+04 1.09e+04 4.59e-05 ...
##  $ StartParam       : num [1:4] 247.151 -0.649 42.098 1.944
##  $ StartParamDistrib: num [1:3, 1:4] 169.017 247.151 432.681 -2.376 -0.649 ...
##  - attr(*, &quot;class&quot;)= chr [1:3] &quot;CalibOptions&quot; &quot;GR4J&quot; &quot;HBAN&quot;</code></pre>
</div>
</div>
<div id="calibration-run" class="section level2">
<h2><span class="header-section-number">4.2</span> Calibration run</h2>
<p>In the <strong>airGR</strong> package, function <code>Calibration_Michel()</code> allows to run the calibration step. The calibration algorithm optimises the error criterion selected as objective function. This algorithm works in two steps:</p>
<ol style="list-style-type: decimal">
<li>a screening is performed using either a rough predefined grid or a list of parameter sets</li>
<li>a simple steepest descent local search algorithm is performed from the best set of parameters found at the firts step</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OutputsCalib &lt;-<span class="st"> </span><span class="kw">Calibration_Michel</span>(<span class="dt">InputsModel =</span> InputsModel, <span class="dt">RunOptions =</span> RunOptions,
                                   <span class="dt">InputsCrit =</span> InputsCrit, <span class="dt">CalibOptions =</span> CalibOptions,
                                   <span class="dt">FUN_MOD =</span> RunModel_GR4J, <span class="dt">FUN_CRIT =</span> ErrorCrit_NSE)</code></pre></div>
<pre><code>##   Grid-Screening in progress (0% 20% 40% 60% 80% 100%) 
##   Screening completed (81 runs): 
##       Param =  247.151 ,   -0.020 ,   83.096 ,    2.384
##       Crit NSE[Q]       = 0.7685
##   Steepest-descent local search in progress 
##   Calibration completed (20 iterations, 226 runs): 
##       Param =  257.238 ,    1.012 ,   88.235 ,    2.208
##       Crit NSE[Q]       = 0.7985</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Param &lt;-<span class="st"> </span>OutputsCalib$ParamFinalR
Param</code></pre></div>
<pre><code>## [1] 257.237556   1.012237  88.234673   2.207958</code></pre>
<p>Only one function <code>Calibration_Michel()</code> is implemented to calibrate the model, but the user can define is own calibration function.</p>
<p>This function returns the parameters of the choosen model. So the number of parameters is not always the same.</p>
</div>
</div>
<div id="validation" class="section level1">
<h1><span class="header-section-number">5</span> Validation</h1>
<p>This step ensures the predictive power of the model. This is to measure the accuracy of the model on samples of data that were not used in its construction, and in particular its timing. The use is to keep data from a period separated from the calibration period. As possible, this control period should correspond to different climatic situations rather than those of the calibration period in order to better point out the qualities and weakness of the model. This exercise is very useful for assessing the robustness of the model, that is to say its ability to keep stable performance outside the stall conditions.</p>
<p>With <strong>airGR</strong> the validation steps are the same as the simulation steps.</p>
</div>
<div id="simulation" class="section level1">
<h1><span class="header-section-number">6</span> Simulation</h1>
<div id="simulation-run" class="section level2">
<h2><span class="header-section-number">6.1</span> Simulation run</h2>
<p>To run a model the user have to use the <code>RunModel*()</code> functions. All the data needed have already been prepared.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OutputsModel &lt;-<span class="st"> </span><span class="kw">RunModel_GR4J</span>(<span class="dt">InputsModel =</span> InputsModel, <span class="dt">RunOptions =</span> RunOptions, <span class="dt">Param =</span> Param)
<span class="kw">str</span>(OutputsModel)</code></pre></div>
<pre><code>## List of 16
##  $ DatesR  : POSIXlt[1:3652], format: &quot;1990-01-01&quot; &quot;1990-01-02&quot; ...
##  $ PotEvap : num [1:3652] 0.3 0.4 0.4 0.3 0.1 0.1 0.1 0.2 0.2 0.3 ...
##  $ Precip  : num [1:3652] 0 9.3 3.2 7.3 0 0 0 0 0.1 0.2 ...
##  $ Prod    : num [1:3652] 196 199 199 201 200 ...
##  $ AE      : num [1:3652] 0.2833 0.4 0.4 0.3 0.0952 ...
##  $ Perc    : num [1:3652] 0.645 0.696 0.703 0.74 0.725 ...
##  $ PR      : num [1:3652] 0.645 5.946 2.383 4.992 0.725 ...
##  $ Q9      : num [1:3652] 1.78 1.52 3.86 3.17 3.45 ...
##  $ Q1      : num [1:3652] 0.2 0.195 0.271 0.387 0.365 ...
##  $ Rout    : num [1:3652] 53.9 53.6 55.3 56.1 56.9 ...
##  $ Exch    : num [1:3652] 0.181 0.18 0.177 0.197 0.207 ...
##  $ AExch   : num [1:3652] 0.362 0.36 0.353 0.393 0.414 ...
##  $ QR      : num [1:3652] 2.05 1.99 2.36 2.55 2.78 ...
##  $ QD      : num [1:3652] 0.381 0.375 0.447 0.584 0.572 ...
##  $ Qsim    : num [1:3652] 2.43 2.37 2.8 3.14 3.35 ...
##  $ StateEnd: num [1:67] 188.5 48.9 NA NA NA ...
##  - attr(*, &quot;class&quot;)= chr [1:3] &quot;OutputsModel&quot; &quot;daily&quot; &quot;GR&quot;</code></pre>
<p>Obviously the user can make his own graphics from the outputs of the <code>RunModel*()</code> functions.</p>
</div>
<div id="results-preview" class="section level2">
<h2><span class="header-section-number">6.2</span> Results preview</h2>
<p>The <strong>airGR</strong> package offers a <code>plot_OutputsModel()</code> function which returns a dashboard of results including various graphs (depending on the model used):</p>
<ul>
<li>time series of total precipitation and simulated flows (and observed flows if provided)</li>
<li>interannual median monthly simulated flow (and observed flows if provided)</li>
<li>correlation plot between simulated and observed flows (if observed flows provided)</li>
<li>cumulative frequency plot for simulated flows (and observed flows if provided)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot_OutputsModel</span>(<span class="dt">OutputsModel =</span> OutputsModel, <span class="dt">Qobs =</span> BasinObs$Qmm[Ind_Run])</code></pre></div>
<p><img src="tutorial_1_example_simple_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="efficiency-criterion" class="section level2">
<h2><span class="header-section-number">6.3</span> Efficiency criterion</h2>
<p>To evaluate the efficiency of the model, it is possible to use the same criterion as defined at the calibration step or to use an other criterion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OutputsCrit &lt;-<span class="st"> </span><span class="kw">ErrorCrit_NSE</span>(<span class="dt">InputsCrit =</span> InputsCrit, <span class="dt">OutputsModel =</span> OutputsModel)
<span class="kw">str</span>(OutputsCrit)</code></pre></div>
<pre><code>## List of 5
##  $ CritValue      : num 0.799
##  $ CritName       : chr &quot;NSE[Q]&quot;
##  $ CritBestValue  : num 1
##  $ Multiplier     : num -1
##  $ Ind_notcomputed: int [1:40] 2405 2406 2407 2408 2409 2410 2411 2412 2413 2414 ...</code></pre>
<div id="refs" class="references">

</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
